SET enable_indexscan = OFF;
SET enable_bitmapscan = OFF;
SET enable_indexonlyscan = OFF;

-- EXPLAIN (ANALYZE, BUFFERS OFF)
SELECT *
FROM name_basics
WHERE birth_year = 1990;

SET enable_indexscan = ON;
SET enable_bitmapscan = ON;
SET enable_indexonlyscan = ON;


=============

// 1000001 because with header
[System.IO.File]::ReadLines("C:\Users\RIVAL\Downloads\imdb dataset\name.basics.tsv") | Select-Object -First 1000001 | Set-Content name.basics.1m.tsv

=============
FIX LINE 677884 di title.basics.1m.tsv because:
COPY error: error: invalid input syntax for type boolean: "1996"
where: 'COPY title_basics, line 677884, column is_adult: "1996"',
solusi: buat fungsi escape value di migration script


============
i need to load all reviews to title_ratings_temp first and then only insert the review for tconst that exist in title_basics
CREATE TABLE title_ratings_temp (
    tconst TEXT PRIMARY KEY,
    average_rating REAL,
    num_votes INTEGER NOT NULL DEFAULT 0
);

// after COPY
INSERT INTO title_ratings 
    SELECT * FROM title_ratings_temp
    WHERE tconst IN (SELECT tconst FROM title_basics)
    ON CONFLICT (tconst) DO NOTHING

====================
-- Count total data from db
SELECT 'genres' AS table_name, COUNT(id) AS row_count FROM genres
UNION ALL
SELECT 'name_basics', COUNT(nconst) FROM name_basics
UNION ALL
SELECT 'name_known_for_titles', COUNT(nconst) FROM name_known_for_titles
UNION ALL
SELECT 'name_primary_professions', COUNT(nconst) FROM name_primary_professions
UNION ALL
SELECT 'principal_categories', COUNT(id) FROM principal_categories
UNION ALL
SELECT 'professions', COUNT(id) FROM professions
UNION ALL
SELECT 'title_basics', COUNT(tconst) FROM title_basics
UNION ALL
SELECT 'title_genres', COUNT(tconst) FROM title_genres
UNION ALL
SELECT 'title_principals', COUNT(tconst) FROM title_principals
UNION ALL
SELECT 'title_ratings', COUNT(tconst) FROM title_ratings
UNION ALL
SELECT 'title_type', COUNT(id) FROM title_type

-- Grand Total row
UNION ALL
SELECT 'TOTAL', 
    (SELECT COUNT(id) FROM genres) +
    (SELECT COUNT(nconst) FROM name_basics) +
    (SELECT COUNT(nconst) FROM name_known_for_titles) +
    (SELECT COUNT(nconst) FROM name_primary_professions) +
    (SELECT COUNT(id) FROM principal_categories) +
    (SELECT COUNT(id) FROM professions) +
    (SELECT COUNT(tconst) FROM title_basics) +
    (SELECT COUNT(tconst) FROM title_genres) +
    (SELECT COUNT(tconst) FROM title_principals) +
    (SELECT COUNT(tconst) FROM title_ratings) +
    (SELECT COUNT(id) FROM title_type);